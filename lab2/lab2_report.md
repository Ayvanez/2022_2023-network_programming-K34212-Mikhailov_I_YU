###### University: [ITMO University](https://itmo.ru/ru/)
###### Faculty: [FICT](https://fict.itmo.ru)
###### Course: [Network programming](https://github.com/itmo-ict-faculty/network-programming)
###### Year: 2022/2023
###### Group: K34212
###### Author: Mikhailov Ivan Yuryevich
###### Lab: Lab2
###### Date of create: 1.10.2022
###### Date of finished: 18.10.2022
***
# Развертывание дополнительного CHR, первый сценарий Ansible
### Задачи работы:
1. Установить второй CHR на своем ПК.
2. Организовать второй OVPN Client на втором CHR.
3. Используя Ansible, настроить сразу на 2-х CHR:
* логин/пароль;
* NTP Client;
* OSPF с указанием Router ID; 
4. Собрать данные по OSPF топологии и полный конфиг устройства.

### Ход Работы
1. Следуя тем же пунктам из лабораторной 1 установлен 2 CHR на виртуальной машине.
2. После установки openVPN клиента на второй машине установлено соединение с виртульной машиной  яндекс по впн туннелю.

  <img src="https://user-images.githubusercontent.com/56927592/196499347-90852bac-7efb-4409-b13b-891f0b800b15.png" width="800" height="340" />

3. Для настройки Ansible был создан инвентори файл с перечислением всех подключенных устройств, указанием что подключение по сети происходит с помощью cli, а так же что нужно интерпретировать команды для ос Routeros.

  <img src="https://user-images.githubusercontent.com/56927592/196501131-a67dae93-dc33-4d6d-a067-1f069bca3d27.png" width="240" height="190" />

Далее произведена проверка подключения ансибла к хостам командой ansible -m ping.

<img src="https://user-images.githubusercontent.com/56927592/196502156-b7931444-fbaf-4f90-bfa3-3a76e7881fb5.png" width="300" height="100" />

 После этого написан сценарий playbook с 3 плеями - установления нового юзера с логином и паролем; установление ntp client с российским сервером; и настройка протокола ospf.
 
<img src="https://user-images.githubusercontent.com/56927592/196503816-0dc217f9-8f59-4e4b-87e7-432a7c4f8465.png" width="500" height="440" />

Настройка ospf была самой сложной. Нужно было придать всем роутерам уникальный routerID, чтобы была составлена точная карта маршрутизации. Для создаётся отдельный loopback интерфейс и его адрес используется в качестве router-id. Однако он должен быть уникальным для этого пришлось создать переменную router_id в папке host_vars для каждого хоста. 

<img src="https://user-images.githubusercontent.com/56927592/196505459-2e3e18a3-d5c7-4bef-bbf9-b83a2fc0f7e1.png" width="450" height="170" />

Непосредственно настройка ospf состоит из добавления instance, area и interface-template, который использует интерфейс выходящий в локальную сеть домашнего роутера, для связи двух роутеров между собой.

Проверим установленные параметры на машинах:

<img src="https://user-images.githubusercontent.com/56927592/196508819-5b7be08e-2ff0-4738-88d3-7f47caf10295.png" width="700" height="500" />

4. Проверены маршруты на маршрутизаторах и проверены состояния каналов выводом списка LSA.

<img src="https://user-images.githubusercontent.com/56927592/196495846-a3560472-e3c1-4dc0-94f9-c549c0caec5a.png" width="500" height="600" />

Просмотрен полный конфиг устройства, где можно ещё раз увидеть все настройки, применённые использованием ансибла

<img src="https://user-images.githubusercontent.com/56927592/196510896-bb5995fc-e3df-47f9-b962-14ab3a71a671.png" width="750" height="600" />

### Вывод
В ходе выполнения лабораторноя работы было получено понимание как соединяются машины друг с другом, в частности по сетевым мостам и по ssh. Так же были получены навыки работы с Ansible - важнейшие термины: инвентори, плейбуки, таски, host_vars. Получено понимание зачем нужен данный инструмент - для оптимизации и автоматизации настройки машин в сети.

В итоге получилась следующая сеть:

<img src="https://user-images.githubusercontent.com/56927592/196662085-919e0313-d58f-4135-a31f-93c8b77491e3.png" width="500" height="400" />

